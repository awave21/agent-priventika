import{d as B,u as N,r as m,q,j as v,k as A,l as D,i as n,b as e,c as i,e as _,g as y,f as b,v as w,F as C,m as k,n as h,t as a,h as I,w as T}from"./index-J5MGib1M.js";import{_ as F}from"./AppLayout.vue_vue_type_script_setup_true_lang-CJ_uuTcT.js";import{c as j}from"./createLucideIcon-BGKXoyUX.js";/**
 * @license lucide-vue-next v0.485.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=j("search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-vue-next v0.485.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=j("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),$={class:"flex h-full"},E={class:"w-96 bg-white border-r border-slate-200 flex flex-col"},Q={class:"p-4 border-b border-slate-200"},G={class:"relative"},H={class:"flex-1 overflow-y-auto"},J=["onClick"],K={class:"w-12 h-12 rounded-full bg-slate-200 flex items-center justify-center flex-shrink-0"},O={class:"text-slate-600 font-medium"},P={class:"flex-1 text-left min-w-0"},W={class:"flex items-center justify-between mb-1"},X={class:"font-medium text-slate-900 truncate"},Y={class:"text-xs text-slate-500"},Z={class:"text-sm text-slate-600 truncate"},ee={key:0,class:"flex-1 flex flex-col bg-slate-50"},te={class:"h-16 bg-white border-b border-slate-200 flex items-center px-6"},se={class:"w-10 h-10 rounded-full bg-slate-200 flex items-center justify-center mr-3"},le={class:"text-slate-600 font-medium"},ae={class:"font-medium text-slate-900"},oe={class:"flex-1 overflow-y-auto p-6 space-y-4"},ne={class:"text-sm"},ie={class:"flex items-center gap-2 mt-1"},re={class:"text-xs opacity-70"},de={key:0,class:"text-xs opacity-70"},ce={class:"bg-white border-t border-slate-200 p-4"},ue=["disabled"],fe={key:1,class:"flex-1 flex items-center justify-center bg-slate-50"},xe={class:"text-center"},pe={class:"w-20 h-20 bg-slate-200 rounded-full flex items-center justify-center mx-auto mb-4"},he=B({__name:"ChatView",setup(me){const U=q(),d=N(),o=m(U.params.id||null),r=m(""),f=m(""),c=(l,s)=>(l==null?void 0:l.name)||(l==null?void 0:l.username)||(l==null?void 0:l.phone)||s||"Неизвестно",L=v(()=>{if(!f.value)return d.activeChats.value;const l=f.value.toLowerCase();return d.activeChats.value.filter(s=>{var p;const t=c(s.user,s.id),x=((p=s.user)==null?void 0:p.phone)||"";return t.toLowerCase().includes(l)||x.toLowerCase().includes(l)})}),u=v(()=>o.value?d.getChatById(o.value):null),S=v(()=>o.value?d.getChatMessages(o.value):[]),V=l=>{o.value=l},z=()=>{!r.value.trim()||!o.value||(d.sendMessage(o.value,r.value,!1),r.value="")},g=l=>new Date(l).toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"});return(l,s)=>(n(),A(F,null,{default:D(()=>[e("div",$,[e("div",E,[e("div",Q,[s[2]||(s[2]=e("h2",{class:"text-xl font-semibold text-slate-900 mb-4"},"Чаты",-1)),e("div",G,[_(b(M),{size:18,class:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"}),y(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>f.value=t),type:"text",placeholder:"Поиск чатов...",class:"w-full pl-10 pr-4 py-2 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-slate-900 focus:border-transparent"},null,512),[[w,f.value]])])]),e("div",H,[(n(!0),i(C,null,k(L.value,t=>{var x;return n(),i("button",{key:t.id,onClick:p=>V(t.id),class:h(["w-full px-4 py-3 flex items-center gap-3 hover:bg-slate-50 transition-colors border-b border-slate-100",{"bg-slate-100":o.value===t.id}])},[e("div",K,[e("span",O,a(c(t.user,t.id)[0].toUpperCase()),1)]),e("div",P,[e("div",W,[e("h3",X,a(c(t.user,t.id)),1),e("span",Y,a(g(t.lastMessageAt)),1)]),e("p",Z,a(((x=t.lastMessage)==null?void 0:x.text)||"Нет сообщений"),1)])],10,J)}),128))])]),u.value?(n(),i("div",ee,[e("div",te,[e("div",se,[e("span",le,a(c(u.value.user,u.value.id)[0].toUpperCase()),1)]),e("div",null,[e("h3",ae,a(c(u.value.user,u.value.id)),1),s[3]||(s[3]=e("p",{class:"text-xs text-slate-500"},"Онлайн",-1))])]),e("div",oe,[(n(!0),i(C,null,k(S.value,t=>(n(),i("div",{key:t.id,class:h(["flex",t.isUserMessage?"justify-start":"justify-end"])},[e("div",{class:h(["max-w-md px-4 py-3 rounded-2xl",t.isUserMessage?"bg-white text-slate-900":t.isAgent?"bg-emerald-500 text-white":"bg-slate-700 text-white"])},[e("p",ne,a(t.text),1),e("div",ie,[e("span",re,a(g(t.createdAt)),1),t.isUserMessage?I("",!0):(n(),i("span",de," • "+a(t.isAgent?"Агент":"Менеджер"),1))])],2)],2))),128))]),e("div",ce,[e("form",{onSubmit:T(z,["prevent"]),class:"flex items-center gap-3"},[y(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>r.value=t),type:"text",placeholder:"Введите сообщение...",class:"flex-1 px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-slate-900 focus:border-transparent"},null,512),[[w,r.value]]),e("button",{type:"submit",disabled:!r.value.trim(),class:"p-3 bg-slate-900 text-white rounded-xl hover:bg-slate-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[_(b(R),{size:20})],8,ue)],32)])])):(n(),i("div",fe,[e("div",xe,[e("div",pe,[_(b(M),{size:32,class:"text-slate-400"})]),s[4]||(s[4]=e("h3",{class:"text-lg font-medium text-slate-900 mb-2"},"Выберите чат",-1)),s[5]||(s[5]=e("p",{class:"text-sm text-slate-600"},"Выберите чат из списка слева, чтобы начать общение",-1))])]))])]),_:1}))}});export{he as default};
